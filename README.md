# ä¸­æ–­å­ç¯å¢ƒéªŒè¯ç³»ç»Ÿ (int_subenv)

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºUVMçš„ä¸­æ–­è·¯ç”±éªŒè¯ç¯å¢ƒï¼Œç”¨äºéªŒè¯å¤æ‚SoCä¸­çš„ä¸­æ–­è·¯ç”±é€»è¾‘ã€‚ç³»ç»Ÿæ”¯æŒå¤šç§ä¸­æ–­ç±»å‹ã€mergeé€»è¾‘éªŒè¯ã€ä»¥åŠå®Œæ•´çš„ä¸­æ–­æ¿€åŠ±å’Œæ£€æµ‹æœºåˆ¶ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### 1. ä¸­æ–­è·¯ç”±å»ºæ¨¡
- **Excelé©±åŠ¨é…ç½®**: ä»`int_vector.xlsx`è‡ªåŠ¨ç”Ÿæˆä¸­æ–­æ˜ å°„
- **å¤šç›®æ ‡è·¯ç”±**: æ”¯æŒAPã€SCPã€MCPã€IMUç­‰å¤šä¸ªç›®æ ‡
- **ç»„ç»‡åˆ†ç±»**: æŒ‰IOSUBã€USBã€SCPã€MCPç­‰ç»„åˆ«ç®¡ç†ä¸­æ–­

### 2. Mergeä¸­æ–­éªŒè¯
- **PLLä¸­æ–­åˆå¹¶**: æ”¯æŒlockã€unlockã€frechangedoneç­‰PLLä¸­æ–­çš„mergeé€»è¾‘
- **ç³»ç»Ÿçº§merge**: æ”¯æŒnormalã€errorã€RASç­‰ç³»ç»Ÿçº§ä¸­æ–­åˆå¹¶
- **æºä¸­æ–­è¿½è¸ª**: å®Œæ•´çš„mergeæºä¸­æ–­å…³ç³»å»ºæ¨¡

### 3. æ¿€åŠ±åˆè§„æ€§
- **å¤šç§è§¦å‘ç±»å‹**: Levelã€Edgeã€Pulseè§¦å‘æ”¯æŒ
- **ææ€§å¤„ç†**: Active High/Lowã€Rising/Falling Edge
- **åˆè§„æ€§æ£€æŸ¥**: è‡ªåŠ¨éªŒè¯æ¿€åŠ±æ–¹æ³•ä¸ä¸­æ–­è§„æ ¼çš„åŒ¹é…åº¦

### 4. UVMæ ‡å‡†æ¶æ„
- **Sequence-Driveræ¶æ„**: æ ‡å‡†UVMç»„ä»¶åˆ†ç¦»
- **äº‹ä»¶é©±åŠ¨æ¡æ‰‹**: ç²¾ç¡®çš„stimulus-detectionåŒæ­¥
- **æ¨¡å—åŒ–è®¾è®¡**: æ˜“äºæ‰©å±•å’Œç»´æŠ¤

## ç›®å½•ç»“æ„

```
int_subenv/
â”œâ”€â”€ README.md                          # é¡¹ç›®ä¸»æ–‡æ¡£
â”œâ”€â”€ int_vector.xlsx                     # ä¸­æ–­å‘é‡è¡¨é…ç½®æ–‡ä»¶
â”œâ”€â”€ ä¸­æ–­å‘é‡è¡¨-iosub-V0.5.csv          # CSVæ ¼å¼ä¸­æ–­å‘é‡è¡¨
â”œâ”€â”€ cfg/                               # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ int.mk                         # Makefileé…ç½®
â”œâ”€â”€ env/                               # UVMç¯å¢ƒç»„ä»¶
â”‚   â”œâ”€â”€ int_subenv.sv                  # ä¸»ç¯å¢ƒ
â”‚   â”œâ”€â”€ int_driver.sv                  # ä¸­æ–­æ¿€åŠ±é©±åŠ¨å™¨
â”‚   â”œâ”€â”€ int_monitor.sv                 # ä¸­æ–­ç›‘æ§å™¨
â”‚   â”œâ”€â”€ int_scoreboard.sv              # è®¡åˆ†æ¿
â”‚   â”œâ”€â”€ int_sequencer.sv               # åºåˆ—å™¨
â”‚   â””â”€â”€ int_event_manager.sv           # äº‹ä»¶ç®¡ç†å™¨
â”œâ”€â”€ seq/                               # åºåˆ—å’Œæ¨¡å‹
â”‚   â”œâ”€â”€ int_base_sequence.sv           # åŸºç¡€åºåˆ—ç±»
â”‚   â”œâ”€â”€ int_lightweight_sequence.sv    # è½»é‡çº§æµ‹è¯•åºåˆ—
â”‚   â”œâ”€â”€ int_routing_model.sv           # ä¸­æ–­è·¯ç”±é¢„æµ‹æ¨¡å‹
â”‚   â”œâ”€â”€ int_stimulus_item.sv           # æ¿€åŠ±äº‹åŠ¡ç±»
â”‚   â”œâ”€â”€ int_transaction.sv             # åŸºç¡€äº‹åŠ¡ç±»
â”‚   â”œâ”€â”€ int_def.sv                     # æ•°æ®ç»“æ„å®šä¹‰
â”‚   â””â”€â”€ int_map_entries.svh            # è‡ªåŠ¨ç”Ÿæˆçš„ä¸­æ–­æ˜ å°„
â”œâ”€â”€ test/                              # æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ int_tc_base.sv                 # åŸºç¡€æµ‹è¯•ç±»
â”‚   â”œâ”€â”€ tc_int_routing.sv              # è·¯ç”±æµ‹è¯•
â”‚   â”œâ”€â”€ tc_merge_interrupt_test.sv     # Mergeä¸­æ–­æµ‹è¯•
â”‚   â”œâ”€â”€ tc_handshake_test.sv           # æ¡æ‰‹æœºåˆ¶æµ‹è¯•
â”‚   â””â”€â”€ tc_*.sv                        # å…¶ä»–æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ tb/                                # æµ‹è¯•å¹³å°
â”‚   â”œâ”€â”€ int_harness.sv                 # æµ‹è¯•çº¿æŸ
â”‚   â”œâ”€â”€ int_interface.sv               # æ¥å£å®šä¹‰
â”‚   â””â”€â”€ top_tb.f                       # æ–‡ä»¶åˆ—è¡¨
â”œâ”€â”€ rtl/                               # RTLå‚è€ƒæ¨¡å‹
â”‚   â””â”€â”€ int_controller.sv              # ä¸­æ–­æ§åˆ¶å™¨
â””â”€â”€ tools/                             # å·¥å…·è„šæœ¬
    â”œâ”€â”€ convert_xlsx_to_sv.py          # Excelè½¬æ¢å·¥å…·
    â”œâ”€â”€ check_stimulus_compliance.py   # åˆè§„æ€§æ£€æŸ¥
    â”œâ”€â”€ verify_merge_implementation.py # Mergeé€»è¾‘éªŒè¯
    â””â”€â”€ analyze_interrupt_comments.py  # æ³¨é‡Šåˆ†æå·¥å…·
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# ç¡®ä¿æœ‰Python 3.6+ç¯å¢ƒ
pip install pandas openpyxl

# æ£€æŸ¥å¿…è¦æ–‡ä»¶
ls int_vector.xlsx ä¸­æ–­å‘é‡è¡¨-iosub-V0.5.csv
```

### 2. ç”Ÿæˆä¸­æ–­æ˜ å°„
```bash
# ä»Excelç”ŸæˆSystemVerilogæ˜ å°„æ–‡ä»¶
python3 tools/convert_xlsx_to_sv.py int_vector.xlsx

# éªŒè¯ç”Ÿæˆç»“æœ
python3 tools/test_new_system.py
```

### 3. è¿è¡Œåˆè§„æ€§æ£€æŸ¥
```bash
# æ£€æŸ¥æ¿€åŠ±æ–¹æ³•åˆè§„æ€§
python3 tools/check_stimulus_compliance.py

# éªŒè¯mergeé€»è¾‘å®ç°
python3 tools/verify_merge_implementation.py
```

### 4. è¿è¡Œæµ‹è¯•
```bash
# åŸºç¡€è·¯ç”±æµ‹è¯•
make -f cfg/int.mk tc_int_routing

# Mergeä¸­æ–­æµ‹è¯•
make -f cfg/int.mk tc_merge_interrupt_test

# å®Œæ•´å›å½’æµ‹è¯•
make -f cfg/int.mk regression
```

## ä¸»è¦ç‰¹æ€§

### Excelé©±åŠ¨é…ç½®
- æ”¯æŒå¤šé¡µç­¾Excelæ–‡ä»¶è§£æ
- è‡ªåŠ¨æå–ä¸­æ–­åç§°ã€ç´¢å¼•ã€ç›®æ ‡è·¯ç”±ä¿¡æ¯
- ç”Ÿæˆæ ‡å‡†SystemVerilogæ•°æ®ç»“æ„

### æ™ºèƒ½Mergeé€»è¾‘
- è‡ªåŠ¨è¯†åˆ«mergeä¸­æ–­å…³ç³»
- æ”¯æŒå¤æ‚çš„å¤šæºä¸­æ–­åˆå¹¶
- å®Œæ•´çš„æºä¸­æ–­è¿½è¸ªå’ŒéªŒè¯

### é«˜ç²¾åº¦æ¿€åŠ±
- åŸºäºä¸­æ–­è§„æ ¼çš„ç²¾ç¡®æ¿€åŠ±ç”Ÿæˆ
- æ”¯æŒLevelã€Edgeã€Pulseç­‰å¤šç§è§¦å‘ç±»å‹
- è‡ªåŠ¨é€‚é…Active High/Lowææ€§

### äº‹ä»¶é©±åŠ¨åŒæ­¥
- æ›¿ä»£å›ºå®šå»¶è¿Ÿçš„ç²¾ç¡®æ¡æ‰‹æœºåˆ¶
- Monitor-Sequenceäº‹ä»¶é€šä¿¡
- æé«˜ä»¿çœŸæ•ˆç‡å’Œå‡†ç¡®æ€§

## éªŒè¯è¦†ç›–ç‡

å½“å‰ç³»ç»ŸéªŒè¯çŠ¶æ€ï¼š
- âœ… **ä¸­æ–­æ˜ å°„**: 423ä¸ªä¸­æ–­å®Œæ•´å»ºæ¨¡
- âœ… **Mergeé€»è¾‘**: 12ä¸ªmergeä¸­æ–­100%å®ç°
- âœ… **æ¿€åŠ±åˆè§„**: 96.2%åˆè§„ç‡
- âœ… **æ¶æ„å®Œæ•´**: UVMæ ‡å‡†æ¶æ„å®Œå…¨å®ç°

## æ¥å…¥DUTå‡†å¤‡äº‹é¡¹

### å·²å®Œæˆé¡¹ç›®
1. âœ… ä¸­æ–­å‘é‡è¡¨å»ºæ¨¡å®Œæˆ
2. âœ… Mergeé€»è¾‘å®ç°å®Œæˆ
3. âœ… æ¿€åŠ±æ–¹æ³•åˆè§„æ€§éªŒè¯
4. âœ… UVMæ¶æ„æ ‡å‡†åŒ–
5. âœ… äº‹ä»¶é©±åŠ¨æ¡æ‰‹æœºåˆ¶
6. âœ… è‡ªåŠ¨åŒ–å·¥å…·é“¾å®Œå–„

### å¾…å®Œæˆäº‹é¡¹
1. **RTLæ¥å£é€‚é…**
   - è¿æ¥å®é™…DUTçš„ä¸­æ–­ä¿¡å·
   - é…ç½®æ­£ç¡®çš„ä¿¡å·è·¯å¾„
   - éªŒè¯æ—¶é’ŸåŸŸå’Œå¤ä½é€»è¾‘

2. **æ—¶åºå‚æ•°è°ƒä¼˜**
   - æ ¹æ®å®é™…DUTè°ƒæ•´æ¿€åŠ±æ—¶åº
   - ä¼˜åŒ–æ£€æµ‹çª—å£å’Œè¶…æ—¶è®¾ç½®
   - é…ç½®åˆé€‚çš„æ—¶é’Ÿé¢‘ç‡

3. **è¦†ç›–ç‡é…ç½®**
   - è®¾ç½®åŠŸèƒ½è¦†ç›–ç‡æ”¶é›†ç‚¹
   - é…ç½®æ–­è¨€å’Œæ£€æŸ¥å™¨
   - å»ºç«‹è¦†ç›–ç‡ç›®æ ‡å’ŒæŠ¥å‘Š

4. **å›å½’æµ‹è¯•å»ºç«‹**
   - å»ºç«‹å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
   - é…ç½®CI/CDæµæ°´çº¿
   - è®¾ç½®æ€§èƒ½åŸºå‡†å’Œè´¨é‡é—¨ç¦

## å·¥å…·ä½¿ç”¨

### Excelè½¬æ¢å·¥å…·
```bash
python3 tools/convert_xlsx_to_sv.py int_vector.xlsx -o seq/int_map_entries.svh
```

### åˆè§„æ€§æ£€æŸ¥
```bash
python3 tools/check_stimulus_compliance.py
# ç”Ÿæˆ: stimulus_compliance_report.md
```

### Mergeé€»è¾‘éªŒè¯
```bash
python3 tools/verify_merge_implementation.py
# éªŒè¯æ‰€æœ‰mergeå…³ç³»çš„æ­£ç¡®å®ç°
```

## ğŸ”„ æ–‡ä»¶æ›´æ–°æµç¨‹

### å¿«é€Ÿæ›´æ–°ï¼ˆæ¨èï¼‰

å½“Excelè¡¨æ ¼æˆ–hierarchyä¿¡å·å±‚æ¬¡æœ‰æ›´æ–°æ—¶ï¼Œä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼š

```bash
# ä»Excelæ–‡ä»¶å®Œæ•´æ›´æ–°
./tools/update_interrupt_files.sh -e interrupt_spec.xlsx -v

# åªæ›´æ–°hierarchyè·¯å¾„
./tools/update_interrupt_files.sh -h -v

# éªŒè¯å½“å‰é…ç½®
python3 tools/validate_config.py
```

### é…ç½®æ–‡ä»¶ç®¡ç†

ç³»ç»Ÿç°åœ¨ä½¿ç”¨JSONé…ç½®æ–‡ä»¶ç®¡ç†hierarchyä¿¡æ¯ï¼š

- **é…ç½®æ–‡ä»¶**: `config/hierarchy_config.json`
- **ä¿¡å·è·¯å¾„ç”Ÿæˆå™¨**: `tools/generate_signal_paths.py`
- **RTLè·¯å¾„æ›´æ–°å·¥å…·**: `tools/update_rtl_paths.py`
- **é…ç½®éªŒè¯å·¥å…·**: `tools/validate_config.py`

### æ›´æ–°æ­¥éª¤

1. **æ›´æ–°Excelè¡¨æ ¼** â†’ è¿è¡Œ `excel_to_sv.py`
2. **æ›´æ–°hierarchyé…ç½®** â†’ ä¿®æ”¹ `config/hierarchy_config.json`
3. **é‡æ–°ç”ŸæˆRTLè·¯å¾„** â†’ è¿è¡Œ `update_rtl_paths.py`
4. **éªŒè¯ç»“æœ** â†’ è¿è¡Œ `validate_config.py`

è¯¦ç»†æµç¨‹è¯·å‚è€ƒï¼š`docs/interrupt_update_workflow.md`

### æ”¯æŒçš„Hierarchyè·¯å¾„

```
IOSUB TOP: top_tb.multidie_top.DUT[0].u_str_top.u_iosub_top_wrap
MCP TOP:   top_tb.multidie_top.DUT[0].u_str_top.u_iosub_top_wrap.u0_iosub_top_wrap_hd.u0_iosub_top_wrap_raw.u_mcp_top
SCP TOP:   top_tb.multidie_top.DUT[0].u_str_top.u_iosub_top_wrap.u0_iosub_top_wrap_hd.u0_iosub_top_wrap_raw.u_scp_top_wrapper
```

### ç»Ÿè®¡ä¿¡æ¯

- **æ€»ä¸­æ–­æ¡ç›®**: 421ä¸ª
- **æ”¯æŒçš„ä¸­æ–­ç»„**: 11ä¸ªï¼ˆCSUBã€PSUBã€DDR0/1/2ã€ACCELã€D2Dã€SCPã€MCPç­‰ï¼‰
- **ç›®æ ‡æ˜ å°„**: 6ç§ï¼ˆSCPã€MCPã€APã€IMUã€IOã€Other Dieï¼‰
- **é…ç½®éªŒè¯**: å®Œæ•´è¦†ç›–æ‰€æœ‰ä¿¡å·è·¯å¾„

## è´¡çŒ®æŒ‡å—

1. éµå¾ªUVMæœ€ä½³å®è·µ
2. ä¿æŒä»£ç ç®€æ´å’Œå¯è¯»æ€§
3. æ·»åŠ å……åˆ†çš„æ³¨é‡Šå’Œæ–‡æ¡£
4. è¿è¡Œå®Œæ•´çš„å›å½’æµ‹è¯•
5. æ›´æ–°ç›¸å…³æ–‡æ¡£
6. **æ›´æ–°é…ç½®æ–‡ä»¶æ—¶ï¼Œè¯·å…ˆè¿è¡ŒéªŒè¯è„šæœ¬**
7. **æäº¤å‰ç¡®ä¿æ‰€æœ‰éªŒè¯æµ‹è¯•é€šè¿‡**

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨å†…éƒ¨å¼€å‘è®¸å¯è¯ï¼Œä»…ä¾›é¡¹ç›®å›¢é˜Ÿä½¿ç”¨ã€‚

---
*æœ€åæ›´æ–°: 2025-07-17*
*ç‰ˆæœ¬: v2.1 - æ·»åŠ äº†é…ç½®åŒ–hierarchyç®¡ç†å’Œè‡ªåŠ¨åŒ–æ›´æ–°æµç¨‹*
