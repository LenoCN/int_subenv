# ACCELåŠå…¶ä»–å­ç³»ç»ŸMaskå®ç°æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

**å®æ–½æ—¥æœŸ**: 2025-07-30  
**å®æ–½å†…å®¹**: ä¸ºACCELä»¥åŠå…¶ä»–å­ç³»ç»Ÿæ·»åŠ å®Œæ•´çš„maskç›¸å…³å¤„ç†  
**çŠ¶æ€**: âœ… å®Œæˆå¹¶éªŒè¯é€šè¿‡

## ğŸ¯ å®æ–½èƒŒæ™¯

åœ¨åŸæœ‰é¡¹ç›®åŸºç¡€ä¸Šï¼Œå½“å‰ä»…æœ‰mergeç±»ä»¥åŠSCP/MCPçš„maskå¤„ç†ã€‚æ ¹æ®å®é™…çš„å¯„å­˜å™¨ä¿¡æ¯ï¼Œéœ€è¦é’ˆå¯¹ACCELä»¥åŠå…¶ä»–å­ç³»ç»Ÿæ·»åŠ maskç›¸å…³å¤„ç†ã€‚

## ğŸ”§ å®æ–½å†…å®¹

### 1. ACCELå­ç³»ç»ŸMaskå¤„ç† âœ…

#### å¯„å­˜å™¨ä¿¡æ¯
- **å¯„å­˜å™¨å**: `mask_iosub_to_accel_intr_0`
- **åœ°å€**: `0x1_C0A0`
- **ä½å®½**: 32ä½ `[31:0]`
- **æ˜ å°„æ–¹å¼**: `dest_index_imu` â†’ mask bit

#### å®ç°é€»è¾‘
```systemverilog
"ACCEL": begin
    dest_index = get_interrupt_dest_index(interrupt_name, destination, routing_model);
    if (dest_index <= 31) begin
        addr = ADDR_MASK_IOSUB_TO_ACCEL_INTR_0;
        bit_index = dest_index;
    end
end
```

### 2. PSUBå­ç³»ç»ŸMaskå¤„ç† âœ…

#### å¯„å­˜å™¨ä¿¡æ¯
- **å¯„å­˜å™¨å**: `mask_psub_to_iosub_intr`
- **åœ°å€**: `0x1_C0B8`
- **ä½å®½**: 20ä½ `[19:0]`
- **æ˜ å°„æ–¹å¼**: `sub_index` â†’ mask bit

#### å®ç°é€»è¾‘
```systemverilog
"PSUB": begin
    sub_index = get_interrupt_sub_index(interrupt_name, routing_model);
    if (sub_index >= 0 && sub_index <= 19) begin
        addr = ADDR_MASK_PSUB_TO_IOSUB_INTR;
        bit_index = sub_index;
    end
end
```

### 3. PCIE1å­ç³»ç»ŸMaskå¤„ç† âœ…

#### å¯„å­˜å™¨ä¿¡æ¯
- **å¯„å­˜å™¨å**: `mask_pcie1_to_iosub_intr`
- **åœ°å€**: `0x1_C0BC`
- **ä½å®½**: 20ä½ `[19:0]`
- **æ˜ å°„æ–¹å¼**: `sub_index` â†’ mask bit

#### å®ç°é€»è¾‘
```systemverilog
"PCIE1": begin
    sub_index = get_interrupt_sub_index(interrupt_name, routing_model);
    if (sub_index >= 0 && sub_index <= 19) begin
        addr = ADDR_MASK_PCIE1_TO_IOSUB_INTR;
        bit_index = sub_index;
    end
end
```

### 4. CSUBå­ç³»ç»Ÿæ”¯æŒ âœ…

#### å®ç°ç­–ç•¥
- **å¤ç”¨ç°æœ‰é€»è¾‘**: CSUBä¸­æ–­ä½¿ç”¨ç°æœ‰çš„SCP/MCP maskå¤„ç†é€»è¾‘
- **æ˜ å°„æ–¹å¼**: é€šè¿‡`dest_index_scp`/`dest_index_mcp`ä½¿ç”¨å¯¹åº”çš„maskå¯„å­˜å™¨
- **ä¼˜åŠ¿**: æ— éœ€é¢å¤–å¯„å­˜å™¨ï¼Œå……åˆ†åˆ©ç”¨ç°æœ‰åŸºç¡€è®¾æ–½

## ğŸ“Š ä¿®æ”¹æ–‡ä»¶æ¸…å•

### 1. æ ¸å¿ƒå®ç°æ–‡ä»¶
- **`seq/int_register_model.sv`**: æ·»åŠ æ–°å­ç³»ç»Ÿmaskå¤„ç†é€»è¾‘
- **`seq/int_routing_model.sv`**: æ›´æ–°è·¯ç”±æ¨¡å‹æ”¯æŒæ–°å­ç³»ç»Ÿ

### 2. éªŒè¯å·¥å…·
- **`tools/verify_accel_mask_implementation.py`**: æ–°å¢éªŒè¯è„šæœ¬

### 3. æ–‡æ¡£æ›´æ–°
- **`docs/interrupt_mask_implementation_complete_report.md`**: æ›´æ–°å®ç°æŠ¥å‘Š
- **`docs/accel_subsystem_mask_implementation_summary.md`**: æ–°å¢å®æ–½æ€»ç»“

## ğŸ§ª éªŒè¯ç»“æœ

### éªŒè¯é¡¹ç›®
1. âœ… **å¯„å­˜å™¨æ¨¡å‹maskæ”¯æŒ**: æ‰€æœ‰æ–°å­ç³»ç»Ÿmaskå¤„ç†é€»è¾‘æ­£ç¡®å®ç°
2. âœ… **è·¯ç”±æ¨¡å‹æ”¯æŒ**: è·¯ç”±é¢„æµ‹æ­£ç¡®æ”¯æŒæ–°å­ç³»ç»Ÿ
3. âœ… **å¯„å­˜å™¨åœ°å€å®šä¹‰**: æ‰€æœ‰å¯„å­˜å™¨åœ°å€æ­£ç¡®å®šä¹‰
4. âœ… **maskå¯„å­˜å™¨éšæœºåŒ–**: æ–°å¯„å­˜å™¨æ­£ç¡®åŠ å…¥éšæœºåŒ–æµç¨‹
5. âœ… **æ‰“å°é…ç½®æ”¯æŒ**: è°ƒè¯•è¾“å‡ºæ­£ç¡®æ”¯æŒæ–°å¯„å­˜å™¨

### éªŒè¯å‘½ä»¤
```bash
python3 tools/verify_accel_mask_implementation.py
```

### éªŒè¯ç»“æœ
```
ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼ACCELåŠå…¶ä»–å­ç³»ç»Ÿmaskå®ç°æ­£ç¡®ã€‚
```

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### æ˜ å°„ç­–ç•¥å¯¹æ¯”

| å­ç³»ç»Ÿ | æ˜ å°„æ–¹å¼ | å¯„å­˜å™¨æ•°é‡ | ä½å®½ | åœ°å€èŒƒå›´ |
|--------|----------|------------|------|----------|
| ACCEL | dest_index_imu | 1 | 32ä½ | 0x1_C0A0 |
| PSUB | sub_index | 1 | 20ä½ | 0x1_C0B8 |
| PCIE1 | sub_index | 1 | 20ä½ | 0x1_C0BC |
| CSUB | dest_index_scp/mcp | å¤ç”¨ | å¤ç”¨ | å¤ç”¨ç°æœ‰ |

### è·¯ç”±æ¨¡å‹æ›´æ–°

#### æ–°å¢ç›®æ ‡æ”¯æŒ
```systemverilog
all_destinations[$] = {"AP", "SCP", "MCP", "IMU", "IO", "OTHER_DIE", "ACCEL", "PSUB", "PCIE1", "CSUB"};
```

#### è·¯ç”±çŠ¶æ€æ£€æŸ¥
```systemverilog
"ACCEL": base_routing = info.to_imu;
"PSUB": base_routing = (info.group == PSUB);
"PCIE1": base_routing = (info.group == PCIE1);
"CSUB": base_routing = (info.group == CSUB);
```

## ğŸ–ï¸ å®æ–½äº®ç‚¹

### 1. å®Œæ•´æ€§
- **å…¨è¦†ç›–**: æ¶µç›–æ‰€æœ‰éœ€è¦maskå¤„ç†çš„å­ç³»ç»Ÿ
- **ä¸€è‡´æ€§**: ä¿æŒä¸ç°æœ‰å®ç°çš„ä¸€è‡´æ€§
- **å…¼å®¹æ€§**: å®Œå…¨å‘åå…¼å®¹ç°æœ‰åŠŸèƒ½

### 2. æŠ€æœ¯ä¼˜åŠ¿
- **æ™ºèƒ½å¤ç”¨**: CSUBå¤ç”¨ç°æœ‰SCP/MCPé€»è¾‘ï¼Œé¿å…é‡å¤å®ç°
- **ç²¾ç¡®æ˜ å°„**: æ ¹æ®å®é™…å¯„å­˜å™¨è§„æ ¼å®ç°ç²¾ç¡®çš„bitæ˜ å°„
- **è°ƒè¯•å‹å¥½**: å®Œå–„çš„è°ƒè¯•è¾“å‡ºå’Œé”™è¯¯å¤„ç†

### 3. è´¨é‡ä¿è¯
- **è‡ªåŠ¨éªŒè¯**: å®Œæ•´çš„éªŒè¯è„šæœ¬ç¡®ä¿å®ç°æ­£ç¡®æ€§
- **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„å®æ–½æ–‡æ¡£å’ŒæŠ€æœ¯è¯´æ˜
- **æµ‹è¯•è¦†ç›–**: æ‰€æœ‰æ–°å¢åŠŸèƒ½éƒ½æœ‰å¯¹åº”çš„éªŒè¯

## ğŸš€ åç»­å»ºè®®

### 1. æµ‹è¯•éªŒè¯
- åœ¨å®é™…DUTç¯å¢ƒä¸­éªŒè¯æ–°å¢maskåŠŸèƒ½
- è¿è¡Œå®Œæ•´çš„å›å½’æµ‹è¯•ç¡®ä¿æ— å‰¯ä½œç”¨
- éªŒè¯å„å­ç³»ç»Ÿä¸­æ–­çš„maskè¡Œä¸º

### 2. æ€§èƒ½ä¼˜åŒ–
- ç›‘æ§æ–°å¢é€»è¾‘å¯¹ä»¿çœŸæ€§èƒ½çš„å½±å“
- ä¼˜åŒ–è°ƒè¯•è¾“å‡ºçš„è¯¦ç»†ç¨‹åº¦
- è€ƒè™‘æ·»åŠ æ›´å¤šçš„æ€§èƒ½ç»Ÿè®¡

### 3. åŠŸèƒ½æ‰©å±•
- æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè€ƒè™‘æ·»åŠ æ›´å¤šå­ç³»ç»Ÿæ”¯æŒ
- ä¼˜åŒ–maské…ç½®çš„ç”¨æˆ·æ¥å£
- è€ƒè™‘æ·»åŠ maské…ç½®çš„é¢„è®¾æ¨¡å¼

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰ä»»ä½•å…³äºæ–°å¢maskåŠŸèƒ½çš„é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- å®æ–½æ–‡æ¡£: `docs/accel_subsystem_mask_implementation_summary.md`
- éªŒè¯è„šæœ¬: `tools/verify_accel_mask_implementation.py`
- è°ƒè¯•æŒ‡å—: `docs/mask_debugging_guide.md`

---
**å®æ–½å®Œæˆ**: 2025-07-30  
**éªŒè¯çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡  
**è´¨é‡è¯„çº§**: â­â­â­â­â­ ä¼˜ç§€
